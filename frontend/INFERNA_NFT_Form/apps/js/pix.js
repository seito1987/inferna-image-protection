// The default image saved in an array
const defaultImage = {
  "width": "20",
  "height": "20",
  "pixels": [
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(255, 87, 33)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(255, 200, 144)", "rgb(255, 200, 144)", "rgb(0, 0, 0)", "rgb(255, 200, 144)", "rgb(255, 200, 144)", "rgb(0, 0, 0)", "rgb(255, 200, 144)", "rgb(255, 200, 144)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 200, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(0, 0, 0)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(0, 0, 0)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 200, 144)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(255, 224, 144)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(0, 0, 0)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"],
    ["rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)", "rgb(255, 255, 255)"]
  ]
};

$(document).ready(function() {

// Define the variables
  var $table = $('#pixelCanvas');
  var $sizePicker = $("#sizePicker");
  var isDrawing = false;
  var isShiftPressed = false;
  var $colorPalette = $('.palette');
  var $colorPicker = $('#colorPicker');
  var $colorPickerSubmit = $('#colorPickerSubmit');
  var $selectedColor = null;
  var $inputHeight = $('#inputHeight');
  var $inputWidth = $('#inputWidth');

  var makeGrid = function() {

// Clear the table on submit
    $table.find("tr").remove();

// Draw a new table
    var rows = $inputHeight.val();
    var cols = $inputWidth.val();

    for (var x = 1; x <= rows; x++) {
      var tr = document.createElement('tr');
      for (var y = 1; y <= cols; y++) {
        $(tr).append("<td class=\"pixel\"></td>");
      }
      $table.append(tr);
    }
  }

// Apply a new background color to the cells
  var fillPixel = function(pixel) {
    if (isShiftPressed) { // "Erase" on shift + click by making the cell white
      $(pixel).css("background-color", "white");
    } else {
      var color = $selectedColor.css('background-color');
      $(pixel).css("background-color", color);
    }
  }

// Check if Shift is pressed
  var syncShift = function(event) {
    isShiftPressed = event.shiftKey;
  };

// Select a color in the palette
  var selectColor = function($color) {
    $selectedColor = $color;
    $('.palette-color').removeClass('palette-color-selected');
    $selectedColor.addClass('palette-color-selected');
  }

// Helper function to load the default image
  var importImage = function(data) {
    $inputWidth.val(data.width);
    $inputHeight.val(data.height);
    makeGrid();
    jQuery.each($table.find('tr'), function(i, node) {
      jQuery.each($(node).find('td'), function(j, node) {
        $(node).css('background-color', data.pixels[i][j]);
      });
    });
  }

  makeGrid();
  importImage(defaultImage);
  selectColor($('.palette-color').first()); // Make the fist color in the palette selected by default

// Draw on click or click and hold
  $table.on('mousedown', '.pixel', function(event) {
    fillPixel(event.target);
    isDrawing = true;
  });

  $(document).on('mouseup', function() {
    isDrawing = false;
  });

  $(document).keydown(syncShift);
  $(document).keyup(syncShift);

  $table.on('mouseenter', '.pixel', function(event) {
    if (isDrawing) {
      fillPixel(event.target);
    }
  });

  $sizePicker.submit(function(event) {
    event.preventDefault();
    makeGrid();
  });

  $('.palette').on('click', '.palette-color', function(event) {
    selectColor($(event.target));
  });

  $('#colorPickerSubmit').click(function() {
    var el = $('<div class="palette-color"></div>').css('background-color', $colorPicker.val());
    $colorPalette.append(" ");
    $colorPalette.append(el);
  });


// Hide / show the grid on clicking the checkbox
  $('#gridToggle').change(function(event) {
    if (event.target.checked) {
      $table.removeClass('pixel-canvas-nogrid');
    } else {
      $table.addClass('pixel-canvas-nogrid');
    }
  });
});
